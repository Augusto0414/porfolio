document.addEventListener("DOMContentLoaded",()=>{const q=document.querySelectorAll(".carousel-container"),n=document.getElementById("lightbox"),E=document.getElementById("lightboxImage"),I=document.getElementById("closeLightbox"),s=document.getElementById("videoLightbox"),t=document.getElementById("lightboxVideo"),x=document.getElementById("lightboxVideoSourceWebm"),S=document.getElementById("lightboxVideoSourceMp4"),g=document.getElementById("closeVideoLightbox");async function p(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}n&&n.parentElement!==document.body&&document.body.appendChild(n),s&&s.parentElement!==document.body&&document.body.appendChild(s),document.querySelectorAll(".carousel-track > div").forEach(e=>{if(e.querySelector(".digiturno-video"))return;const i=u=>{u.stopPropagation();const r=e.querySelector(".carousel-image");r&&n&&E&&(E.src=r.src,E.alt=r.alt,n.parentElement!==document.body&&document.body.appendChild(n),n.classList.remove("hidden"),n.classList.add("flex"),document.body.classList.add("overflow-hidden"))};e.addEventListener("click",i);const d=e.querySelector(".absolute.inset-0");d&&d.addEventListener("click",i)}),I&&I.addEventListener("click",()=>{n&&(n.classList.add("hidden"),n.classList.remove("flex"),document.body.classList.remove("overflow-hidden"))}),n&&n.addEventListener("click",e=>{e.target===n&&(n.classList.add("hidden"),n.classList.remove("flex"),document.body.classList.remove("overflow-hidden"))}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(n&&!n.classList.contains("hidden")&&(n.classList.add("hidden"),n.classList.remove("flex"),document.body.classList.remove("overflow-hidden")),s&&!s.classList.contains("hidden")&&(s.classList.add("hidden"),s.classList.remove("flex"),t&&(t.pause(),t.querySelectorAll("source").forEach(o=>o.setAttribute("src","")),t.load(),document.body.classList.remove("overflow-hidden"))))}),g&&g.addEventListener("click",()=>{s&&(s.classList.add("hidden"),s.classList.remove("flex"),t&&(t.pause(),t.querySelectorAll("source").forEach(e=>e.setAttribute("src","")),t.load(),document.body.classList.remove("overflow-hidden")))}),s&&s.addEventListener("click",e=>{e.target===s&&(s.classList.add("hidden"),s.classList.remove("flex"),t&&(t.pause(),t.querySelectorAll("source").forEach(o=>o.setAttribute("src","")),t.load(),document.body.classList.remove("overflow-hidden")))}),document.querySelectorAll(".expand-video").forEach(e=>{e.addEventListener("click",async o=>{o.stopPropagation();const i=e.closest(".group/video");if(!i)return;const d=i.querySelector(".digiturno-video");if(!d)return;const u=d.getAttribute("data-video-src");if(!u||!s||!t)return;const r=encodeURI(u),c=new URL(r,location.origin),m=c.pathname.substring(0,c.pathname.lastIndexOf("/")),f=c.pathname.substring(c.pathname.lastIndexOf("/")+1).replace(/\.mp4$/i,""),l=`${m}/${f}.webm`,a=`${m}/${f}-h264.mp4`,h=document.getElementById("lightboxVideoSourceWebm"),v=document.getElementById("lightboxVideoSourceMp4");let L=null,b=null;await p(l)&&(L=l),await p(a)&&(b=a),!b&&await p(r)&&(b=r),h&&(h.src=L||""),v&&(v.src=b||""),t.load(),s.classList.remove("hidden"),s.classList.add("flex"),g&&g.focus(),t.muted=!0,t.play().then(()=>{setTimeout(()=>{try{t.muted=!1}catch{}},150)}).catch(k=>{console.error("Error reproducir video en lightbox:",k)})})});const y=document.getElementById("lightboxVideoError"),V=document.getElementById("lightboxVideoDownload");t&&(t.addEventListener("error",e=>{console.error("Error en lightboxVideo:",e,t.currentSrc),y&&(y.classList.remove("hidden"),y.classList.add("flex")),V&&t.currentSrc&&(V.href=t.currentSrc)}),t.addEventListener("loadeddata",()=>{y&&(y.classList.add("hidden"),y.classList.remove("flex"))})),q.forEach(e=>{const o=e.querySelector(".carousel-track"),i=e.querySelectorAll(".carousel-track > div"),d=e.querySelector(".prev"),u=e.querySelector(".next"),r=e.querySelectorAll(".dot");if(!o||!d||!u||i.length===0)return;let c=0;const m=i.length;function w(){e.querySelectorAll(".digiturno-video").forEach(a=>{a.paused||(a.pause(),a.classList.remove("playing"))})}function f(){o&&(w(),o.style.transform=`translateX(-${c*100}%)`),r.forEach((l,a)=>{l.classList.toggle("active",a===c)})}d.addEventListener("click",l=>{l.stopPropagation(),c=(c-1+m)%m,f()}),u.addEventListener("click",l=>{l.stopPropagation(),c=(c+1)%m,f()}),r.forEach((l,a)=>{l.addEventListener("click",h=>{h.stopPropagation(),c=a,f()})})}),document.querySelectorAll(".group\\/video").forEach(e=>{const o=e.querySelector(".digiturno-video"),i=e.querySelector(".video-overlay");if(!o||!i){console.log("Video o overlay no encontrado");return}console.log("Video configurado:",o.dataset.videoSrc),i.addEventListener("click",async d=>{d.stopPropagation(),d.preventDefault();const u=o.dataset.videoSrc;if(!u||!s||!t||!x&&!S)return;try{document.querySelectorAll(".digiturno-video").forEach(b=>{try{b.pause()}catch{}})}catch{}const r=encodeURI(u),c=new URL(r,location.origin),m=c.pathname.substring(0,c.pathname.lastIndexOf("/")),f=c.pathname.substring(c.pathname.lastIndexOf("/")+1).replace(/\.mp4$/i,""),l=`${m}/${f}.webm`,a=`${m}/${f}-h264.mp4`;let h=null,v=null;await p(l)&&(h=l),await p(a)&&(v=a),!v&&await p(r)&&(v=r),x&&(x.src=h||""),S&&(S.src=v||""),t.load(),s.classList.remove("hidden"),s.classList.add("flex"),g&&g.focus(),t.muted=!0,t.play().then(()=>{setTimeout(()=>{try{t.muted=!1}catch{}},150)}).catch(L=>{console.error("Error reproducir video en lightbox:",L)})}),o.addEventListener("click",d=>{d.stopPropagation(),o.paused||o.pause()}),o.addEventListener("pause",()=>{o.classList.remove("playing"),i.style.opacity="1",i.style.pointerEvents="all"}),o.addEventListener("ended",()=>{o.classList.remove("playing"),i.style.opacity="1",i.style.pointerEvents="all",o.currentTime=0}),o.addEventListener("error",d=>{console.error("Error cargando video:",o.src,d),i.style.opacity="1",i.style.pointerEvents="all",o.classList.remove("playing")})})});
